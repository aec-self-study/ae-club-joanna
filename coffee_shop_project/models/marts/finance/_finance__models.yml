version: 2

models:
  - name: monthly_new_customers
    description: 'customers who ordered for the first time, aggregated per month'

    columns:
      - name: order_month
        tests:
          - unique
          - not_null

      - name: new_customers
        tests:
          - not_null

  - name: weekly_revenue
    description: 'weekly revenue per product category and new/returning customer type'

    columns:
      - name: date_week
        tests:
          - not_null


  - name: weekly_customer_revenue
    description: 'one row per customer per week with their revenue and cumulative revenue'

    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - customer_id
            - date_week
            - week_number

    columns:
      - name: total_cumulative_revenue
        tests:
          - dbt_utils.expression_is_true:
              expression: "> 0"